---
layout: post
#标题配置
title:  Arduino与I2C总线协议
#时间配置
date:   2019-03-18 22:16:00 +0800
#大类配置
categories: document
#小类配置
tag: Raspberry Pi/Arduino
---

* content
{:toc}
# I2C总线协议入门

&emsp; &emsp;I2C总线协议（ 全称：Inter Integrated Circuit，又叫 I^2^C，IIC）是一种连接低速设备的通信协议，是由 Philips 在80年代设计的。它有如下几个特点：

* 只需要两条数据线；
* 没有严格的波特率（baud rate）限制
* 主/从关系简单
* 多主控，但任何时间点只能有一个主控。

![I^2^C](http://www.vector-logo.net/logo_preview/eps/i/i2c_Bus.png "I2C")

## 硬件结构

&emsp;&emsp;下面这幅图展示了单个主/从机之间的电路连接：

![I2C连线](https://www.i2c-bus.org/static/i2c/BusSetup.gif "I2C连线")



|      |                                                              |
| ---- | ------------------------------------------------------------ |
| VCC  | 为I2C提供电压，范围为1.2V~5.5V                               |
| GND  | 共地接线                                                     |
| SDA  | Serial data 串行数据（I2C 数据线）                           |
| SCL  | Serial clock 串行时钟（I2C时钟线）                           |
| Rp   | 上拉电阻（大小计算可参考[SLVA689](http://www.ti.com/lit/pdf/SLVA689)） |
| Rs   | 串口电阻                                                     |
| Cp   | Wire Caoacitance 线间电容                                    |
| Cc   | Cross channel capacitance 路间电容                           |

对于多个主/从机，可以这样连接：

![多个从机连线](http://www.cypress.com/sites/default/files/inline/fckImages/myresources/AN50987.jpg "多个从机连线")

&emsp;&emsp;下面重点讲一下双向通信的开漏结构（Open-Drain for Bidirectional Communication），这能帮助我们了解为什么同一时间只允许一个主控。请看结构图：

!["Open-Drain"](/style/images/I2C/open-drain.png "开漏结构 Open-Drain")

&emsp;&emsp;主/从机可以让晶体管的导通（开漏），让SDA/SCL线的电压拉低；当主/从机让晶体管不导通时，上拉电阻会将SDA/SCL线上的电压拉高。也就是说，主/从机只能让SDA/SCL为0，当主/从机不控制时，SDA/SCL为1。因此，永远不会出现一个从机传输0，另一个从机传输1的情况，即同一时间只能有一个设备在传输数据。

&emsp;&emsp;这种结构虽然效率较低，但其驱动电流/电压较小，很适合驱动能力差的微处理器和传感器。

# 参考资料

[SLVA704-Understanding the I2C Bus.pdf](http://www.ti.com/lit/an/slva704/slva704.pdf)